import{r as T}from"./index-Dy2Ak0OH.js";import{r as le}from"./index-C2kXbMnG.js";import{$ as ie}from"./FocusScope-DK3vkfEa.js";import{$ as q}from"./focusSafely-Ch4YQihX.js";import{$ as Z}from"./mergeProps-VNdaC4-V.js";import{b as oe,a as Q,e as se}from"./openLink-BoTcy9x3.js";import{$ as X}from"./useEvent-C6x0jYue.js";import{$ as ce,a as _}from"./scrollIntoView-DWX27Gz-.js";import{a as ee}from"./useFocusWithin-Dv5DP61h.js";import{a as ae}from"./context-DL1kNI1P.js";import{f as ue,a as fe}from"./platform-BknMeRIZ.js";import{c as de,b as ne}from"./usePress-BDQnv3aP.js";import{$ as pe}from"./useDescription-C_123zXK.js";const ye=500;function ve(i){let{isDisabled:e,onLongPressStart:t,onLongPressEnd:l,onLongPress:p,threshold:m=ye,accessibilityDescription:b}=i;const f=T.useRef(void 0);let{addGlobalListener:d,removeGlobalListener:B}=de(),{pressProps:K}=ne({isDisabled:e,onPressStart(s){if(s.continuePropagation(),(s.pointerType==="mouse"||s.pointerType==="touch")&&(t&&t({...s,type:"longpressstart"}),f.current=setTimeout(()=>{s.target.dispatchEvent(new PointerEvent("pointercancel",{bubbles:!0})),p&&p({...s,type:"longpress"}),f.current=void 0},m),s.pointerType==="touch")){let a=M=>{M.preventDefault()};d(s.target,"contextmenu",a,{once:!0}),d(window,"pointerup",()=>{setTimeout(()=>{B(s.target,"contextmenu",a)},30)},{once:!0})}},onPressEnd(s){f.current&&clearTimeout(f.current),l&&(s.pointerType==="mouse"||s.pointerType==="touch")&&l({...s,type:"longpressend"})}}),O=pe(p&&!e?b:void 0);return{longPressProps:Z(K,O)}}function Y(i){return ue()?i.altKey:i.ctrlKey}function R(i){return fe()?i.metaKey:i.ctrlKey}const be=1e3;function $e(i){let{keyboardDelegate:e,selectionManager:t,onTypeSelect:l}=i,p=T.useRef({search:"",timeout:void 0}).current,m=b=>{let f=me(b.key);if(!(!f||b.ctrlKey||b.metaKey||!b.currentTarget.contains(b.target))){if(f===" "&&p.search.trim().length>0&&(b.preventDefault(),"continuePropagation"in b||b.stopPropagation()),p.search+=f,e.getKeyForSearch!=null){let d=e.getKeyForSearch(p.search,t.focusedKey);d==null&&(d=e.getKeyForSearch(p.search)),d!=null&&(t.setFocusedKey(d),l&&l(d))}clearTimeout(p.timeout),p.timeout=setTimeout(()=>{p.search=""},be)}};return{typeSelectProps:{onKeyDownCapture:e.getKeyForSearch?m:void 0}}}function me(i){return i.length===1||!/^[A-Z]/i.test(i)?i:""}function Le(i){let{selectionManager:e,keyboardDelegate:t,ref:l,autoFocus:p=!1,shouldFocusWrap:m=!1,disallowEmptySelection:b=!1,disallowSelectAll:f=!1,selectOnFocus:d=e.selectionBehavior==="replace",disallowTypeAhead:B=!1,shouldUseVirtualFocus:K,allowsTabNavigation:O=!1,isVirtualized:s,scrollRef:a=l,linkBehavior:M="action"}=i,{direction:F}=ae(),P=oe(),C=r=>{var c;if(r.altKey&&r.key==="Tab"&&r.preventDefault(),!(!((c=l.current)===null||c===void 0)&&c.contains(r.target)))return;const u=(n,L)=>{if(n!=null){if(e.isLink(n)&&M==="selection"&&d&&!Y(r)){var x;le.flushSync(()=>{e.setFocusedKey(n,L)});let j=(x=a.current)===null||x===void 0?void 0:x.querySelector(`[data-key="${CSS.escape(n.toString())}"]`),J=e.getItemProps(n);j&&P.open(j,r,J.href,J.routerOptions);return}if(e.setFocusedKey(n,L),e.isLink(n)&&M==="override")return;r.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(n):d&&!Y(r)&&e.replaceSelection(n)}};switch(r.key){case"ArrowDown":if(t.getKeyBelow){var y,$,v;let n=e.focusedKey!=null?(y=t.getKeyBelow)===null||y===void 0?void 0:y.call(t,e.focusedKey):($=t.getFirstKey)===null||$===void 0?void 0:$.call(t);n==null&&m&&(n=(v=t.getFirstKey)===null||v===void 0?void 0:v.call(t,e.focusedKey)),n!=null&&(r.preventDefault(),u(n))}break;case"ArrowUp":if(t.getKeyAbove){var S,o,g;let n=e.focusedKey!=null?(S=t.getKeyAbove)===null||S===void 0?void 0:S.call(t,e.focusedKey):(o=t.getLastKey)===null||o===void 0?void 0:o.call(t);n==null&&m&&(n=(g=t.getLastKey)===null||g===void 0?void 0:g.call(t,e.focusedKey)),n!=null&&(r.preventDefault(),u(n))}break;case"ArrowLeft":if(t.getKeyLeftOf){var N,V,G;let n=e.focusedKey!=null?(N=t.getKeyLeftOf)===null||N===void 0?void 0:N.call(t,e.focusedKey):null;n==null&&m&&(n=F==="rtl"?(V=t.getFirstKey)===null||V===void 0?void 0:V.call(t,e.focusedKey):(G=t.getLastKey)===null||G===void 0?void 0:G.call(t,e.focusedKey)),n!=null&&(r.preventDefault(),u(n,F==="rtl"?"first":"last"))}break;case"ArrowRight":if(t.getKeyRightOf){var z,H,W;let n=e.focusedKey!=null?(z=t.getKeyRightOf)===null||z===void 0?void 0:z.call(t,e.focusedKey):null;n==null&&m&&(n=F==="rtl"?(H=t.getLastKey)===null||H===void 0?void 0:H.call(t,e.focusedKey):(W=t.getFirstKey)===null||W===void 0?void 0:W.call(t,e.focusedKey)),n!=null&&(r.preventDefault(),u(n,F==="rtl"?"last":"first"))}break;case"Home":if(t.getFirstKey){r.preventDefault();let n=t.getFirstKey(e.focusedKey,R(r));e.setFocusedKey(n),n!=null&&(R(r)&&r.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(n):d&&e.replaceSelection(n))}break;case"End":if(t.getLastKey){r.preventDefault();let n=t.getLastKey(e.focusedKey,R(r));e.setFocusedKey(n),n!=null&&(R(r)&&r.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(n):d&&e.replaceSelection(n))}break;case"PageDown":if(t.getKeyPageBelow&&e.focusedKey!=null){let n=t.getKeyPageBelow(e.focusedKey);n!=null&&(r.preventDefault(),u(n))}break;case"PageUp":if(t.getKeyPageAbove&&e.focusedKey!=null){let n=t.getKeyPageAbove(e.focusedKey);n!=null&&(r.preventDefault(),u(n))}break;case"a":R(r)&&e.selectionMode==="multiple"&&f!==!0&&(r.preventDefault(),e.selectAll());break;case"Escape":!b&&e.selectedKeys.size!==0&&(r.stopPropagation(),r.preventDefault(),e.clearSelection());break;case"Tab":if(!O){if(r.shiftKey)l.current.focus();else{let n=ie(l.current,{tabbable:!0}),L,x;do x=n.lastChild(),x&&(L=x);while(x);L&&!L.contains(document.activeElement)&&Q(L)}break}}},h=T.useRef({top:0,left:0});X(a,"scroll",s?void 0:()=>{var r,c,u,y;h.current={top:(u=(r=a.current)===null||r===void 0?void 0:r.scrollTop)!==null&&u!==void 0?u:0,left:(y=(c=a.current)===null||c===void 0?void 0:c.scrollLeft)!==null&&y!==void 0?y:0}});let I=r=>{if(e.isFocused){r.currentTarget.contains(r.target)||e.setFocused(!1);return}if(r.currentTarget.contains(r.target)){if(e.setFocused(!0),e.focusedKey==null){var c,u;let v=o=>{o!=null&&(e.setFocusedKey(o),d&&e.replaceSelection(o))},S=r.relatedTarget;var y,$;S&&r.currentTarget.compareDocumentPosition(S)&Node.DOCUMENT_POSITION_FOLLOWING?v((y=e.lastSelectedKey)!==null&&y!==void 0?y:(c=t.getLastKey)===null||c===void 0?void 0:c.call(t)):v(($=e.firstSelectedKey)!==null&&$!==void 0?$:(u=t.getFirstKey)===null||u===void 0?void 0:u.call(t))}else!s&&a.current&&(a.current.scrollTop=h.current.top,a.current.scrollLeft=h.current.left);if(e.focusedKey!=null&&a.current){let v=a.current.querySelector(`[data-key="${CSS.escape(e.focusedKey.toString())}"]`);v&&(v.contains(document.activeElement)||Q(v),ee()==="keyboard"&&_(v,{containingElement:l.current}))}}},w=r=>{r.currentTarget.contains(r.relatedTarget)||e.setFocused(!1)};const D=T.useRef(p);T.useEffect(()=>{if(D.current){var r,c;let $=null;var u;p==="first"&&($=(u=(r=t.getFirstKey)===null||r===void 0?void 0:r.call(t))!==null&&u!==void 0?u:null);var y;p==="last"&&($=(y=(c=t.getLastKey)===null||c===void 0?void 0:c.call(t))!==null&&y!==void 0?y:null);let v=e.selectedKeys;if(v.size){for(let S of v)if(e.canSelectItem(S)){$=S;break}}e.setFocused(!0),e.setFocusedKey($),$==null&&!K&&l.current&&q(l.current)}},[]);let k=T.useRef(e.focusedKey);T.useEffect(()=>{if(e.isFocused&&e.focusedKey!=null&&(e.focusedKey!==k.current||D.current)&&a.current&&l.current){let r=ee(),c=l.current.querySelector(`[data-key="${CSS.escape(e.focusedKey.toString())}"]`);if(!c)return;(r==="keyboard"||D.current)&&(ce(a.current,c),r!=="virtual"&&_(c,{containingElement:l.current}))}!K&&e.isFocused&&e.focusedKey==null&&k.current!=null&&l.current&&q(l.current),k.current=e.focusedKey,D.current=!1}),X(l,"react-aria-focus-scope-restore",r=>{r.preventDefault(),e.setFocused(!0)});let E={onKeyDown:C,onFocus:I,onBlur:w,onMouseDown(r){a.current===r.target&&r.preventDefault()}},{typeSelectProps:U}=$e({keyboardDelegate:t,selectionManager:e});B||(E=Z(U,E));let A;return K||(A=e.focusedKey==null?0:-1),{collectionProps:{...E,tabIndex:A}}}function Oe(i){let{selectionManager:e,key:t,ref:l,shouldSelectOnPressUp:p,shouldUseVirtualFocus:m,focus:b,isDisabled:f,onAction:d,allowsDifferentPressOrigin:B,linkBehavior:K="action"}=i,O=oe(),s=o=>{if(o.pointerType==="keyboard"&&Y(o))e.toggleSelection(t);else{if(e.selectionMode==="none")return;if(e.isLink(t)){if(K==="selection"&&l.current){let g=e.getItemProps(t);O.open(l.current,o,g.href,g.routerOptions),e.setSelectedKeys(e.selectedKeys);return}else if(K==="override"||K==="none")return}e.selectionMode==="single"?e.isSelected(t)&&!e.disallowEmptySelection?e.toggleSelection(t):e.replaceSelection(t):o&&o.shiftKey?e.extendSelection(t):e.selectionBehavior==="toggle"||o&&(R(o)||o.pointerType==="touch"||o.pointerType==="virtual")?e.toggleSelection(t):e.replaceSelection(t)}};T.useEffect(()=>{t===e.focusedKey&&e.isFocused&&!m&&(b?b():document.activeElement!==l.current&&l.current&&q(l.current))},[l,t,e.focusedKey,e.childFocusStrategy,e.isFocused,m]),f=f||e.isDisabled(t);let a={};!m&&!f?a={tabIndex:t===e.focusedKey?0:-1,onFocus(o){o.target===l.current&&e.setFocusedKey(t)}}:f&&(a.onMouseDown=o=>{o.preventDefault()});let M=e.isLink(t)&&K==="override",F=e.isLink(t)&&K!=="selection"&&K!=="none",P=!f&&e.canSelectItem(t)&&!M,C=(d||F)&&!f,h=C&&(e.selectionBehavior==="replace"?!P:!P||e.isEmpty),I=C&&P&&e.selectionBehavior==="replace",w=h||I,D=T.useRef(null),k=w&&P,E=T.useRef(!1),U=T.useRef(!1),A=o=>{if(d&&d(),F&&l.current){let g=e.getItemProps(t);O.open(l.current,o,g.href,g.routerOptions)}},r={};p?(r.onPressStart=o=>{D.current=o.pointerType,E.current=k,o.pointerType==="keyboard"&&(!w||re())&&s(o)},B?(r.onPressUp=h?void 0:o=>{o.pointerType!=="keyboard"&&P&&s(o)},r.onPress=h?A:void 0):r.onPress=o=>{if(h||I&&o.pointerType!=="mouse"){if(o.pointerType==="keyboard"&&!te())return;A(o)}else o.pointerType!=="keyboard"&&P&&s(o)}):(r.onPressStart=o=>{D.current=o.pointerType,E.current=k,U.current=h,P&&(o.pointerType==="mouse"&&!h||o.pointerType==="keyboard"&&(!C||re()))&&s(o)},r.onPress=o=>{(o.pointerType==="touch"||o.pointerType==="pen"||o.pointerType==="virtual"||o.pointerType==="keyboard"&&w&&te()||o.pointerType==="mouse"&&U.current)&&(w?A(o):P&&s(o))}),a["data-key"]=t,r.preventFocusOnPress=m;let{pressProps:c,isPressed:u}=ne(r),y=I?o=>{D.current==="mouse"&&(o.stopPropagation(),o.preventDefault(),A(o))}:void 0,{longPressProps:$}=ve({isDisabled:!k,onLongPress(o){o.pointerType==="touch"&&(s(o),e.setSelectionBehavior("toggle"))}}),v=o=>{D.current==="touch"&&E.current&&o.preventDefault()},S=e.isLink(t)?o=>{se.isOpening||o.preventDefault()}:void 0;return{itemProps:Z(a,P||h?c:{},k?$:{},{onDoubleClick:y,onDragStartCapture:v,onClick:S}),isPressed:u,isSelected:e.isSelected(t),isFocused:e.isFocused&&e.focusedKey===t,isDisabled:f,allowsSelection:P,hasAction:w}}function te(){let i=window.event;return(i==null?void 0:i.key)==="Enter"}function re(){let i=window.event;return(i==null?void 0:i.key)===" "||(i==null?void 0:i.code)==="Space"}export{Le as $,$e as a,Oe as b,ve as c};
