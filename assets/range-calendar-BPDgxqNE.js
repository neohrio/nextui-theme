import{j as k}from"./jsx-runtime-CS_Wz6c_.js";import{r as c}from"./index-Dy2Ak0OH.js";import{$ as Q,d as W,a as X,e as _,f as Z,g as ee,u as ae,C as te,b as ne}from"./calendar-base-UzSsfGYo.js";import{$ as H}from"./useEvent-C6x0jYue.js";import{t as N,u as re,v as le,w as L,x as se,r as ie}from"./useDateFormatter-C-Agq8ec.js";import{$ as oe}from"./useControlledState-B6nO32B9.js";import{$ as ce}from"./createCalendar-BFX-LVTT.js";import{e as de}from"./mergeProps-VNdaC4-V.js";import{f as ue}from"./filter-dom-props-BPLFryJX.js";import{c as fe}from"./clsx-IIdnr2mY.js";import{f as be}from"./utils-Dl_53iLP.js";function ve(a,e,r){let s=Q(a,e),o=c.useRef(!1),p=c.useRef(typeof window<"u"?window:null);return H(p,"pointerdown",l=>{o.current=l.width===0&&l.height===0}),H(p,"pointerup",l=>{if(o.current){o.current=!1;return}if(e.setDragging(!1),!e.anchorDate)return;let d=l.target;r.current&&r.current.contains(document.activeElement)&&(!r.current.contains(d)||!d.closest('button, [role="button"]'))&&e.selectFocusedDate()}),s.calendarProps.onBlur=l=>{r.current&&(!l.relatedTarget||!r.current.contains(l.relatedTarget))&&e.anchorDate&&e.selectFocusedDate()},H(r,"touchmove",l=>{e.isDragging&&l.preventDefault()},{passive:!1,capture:!0}),s}function ge(a){let{value:e,defaultValue:r,onChange:s,createCalendar:o,locale:p,visibleDuration:g={months:1},minValue:l,maxValue:d,...F}=a,[t,S]=oe(e,r||null,s),[u,y]=c.useState(null),x="center";if(t&&t.start&&t.end){let b=W(N(t.start),g,p,l,d).add(g).subtract({days:1});t.end.compare(b)>0&&(x="start")}let $=c.useRef(null),[f,D]=c.useState(null),w=c.useMemo(()=>re(l,f==null?void 0:f.start),[l,f]),V=c.useMemo(()=>le(d,f==null?void 0:f.end),[d,f]),i=X({...F,value:t&&t.start,createCalendar:o,locale:p,visibleDuration:g,minValue:w,maxValue:V,selectionAlignment:x}),B=n=>{if(n&&a.isDateUnavailable&&!a.allowsNonContiguousRanges){const b=q(n,i,-1),v=q(n,i,1);$.current={start:b,end:v},D($.current)}else $.current=null,D(null)},[U,M]=c.useState(i.visibleRange);(!L(i.visibleRange.start,U.start)||!L(i.visibleRange.end,U.end))&&(B(u),M(i.visibleRange));let P=n=>{n?(y(n),B(n)):(y(null),B(null))},R=u?O(u,i.focusedDate):t&&O(t.start,t.end),E=n=>{if(a.isReadOnly)return;const b=Z(n,w,V),v=ee(b,i.visibleRange.start,a.isDateUnavailable);if(v)if(!u)P(v);else{let A=O(u,v);A&&S({start:Y(A.start,t==null?void 0:t.start),end:Y(A.end,t==null?void 0:t.end)}),P(null)}},[m,j]=c.useState(!1),{isDateUnavailable:h}=a,C=c.useMemo(()=>!t||u?!1:h&&(h(t.start)||h(t.end))?!0:_(t.start,l,d)||_(t.end,l,d),[h,t,u,l,d]),I=a.isInvalid||a.validationState==="invalid"||C;return{...i,value:t,setValue:S,anchorDate:u,setAnchorDate:P,highlightedRange:R,validationState:I?"invalid":null,isValueInvalid:I,selectFocusedDate(){E(i.focusedDate)},selectDate:E,highlightDate(n){u&&i.setFocusedDate(n)},isSelected(n){return!!(R&&n.compare(R.start)>=0&&n.compare(R.end)<=0&&!i.isCellDisabled(n)&&!i.isCellUnavailable(n))},isInvalid(n){var b,v;return i.isInvalid(n)||_(n,(b=$.current)===null||b===void 0?void 0:b.start,(v=$.current)===null||v===void 0?void 0:v.end)},isDragging:m,setDragging:j}}function O(a,e){return!a||!e?null:(e.compare(a)<0&&([a,e]=[e,a]),{start:N(a),end:N(e)})}function Y(a,e){return a=se(a,(e==null?void 0:e.calendar)||new ie),e&&"hour"in e?e.set(a):a}function q(a,e,r){let s=a.add({days:r});for(;(r<0?s.compare(e.visibleRange.start)>=0:s.compare(e.visibleRange.end)<=0)&&!e.isCellUnavailable(s);)s=s.add({days:r});if(e.isCellUnavailable(s))return s.add({days:-r})}function $e({buttonPickerProps:a,className:e,...r}){const{Component:s,slots:o,children:p,domRef:g,locale:l,showHelper:d,minValue:F,maxValue:t,weekdayStyle:S,visibleDuration:u,shouldFilterDOMProps:y,isHeaderExpanded:x,visibleMonths:$,disableAnimation:f,createCalendar:D,showMonthAndYearPickers:w,baseProps:V,getPrevButtonProps:i,getNextButtonProps:B,getErrorMessageProps:U,setIsHeaderExpanded:M,topContent:P,bottomContent:R,errorMessage:E,classNames:m,otherProps:j}=ae({...r,isRange:!0}),h=c.useRef(null),C=ge({...r,locale:l,minValue:F,maxValue:t,visibleDuration:u,createCalendar:!D||typeof D!="function"?ce:D}),{title:I,calendarProps:T,prevButtonProps:n,nextButtonProps:b,errorMessageProps:v}=ve(r,C,g),A=fe(m==null?void 0:m.base,e),z={...a,onPress:de(a==null?void 0:a.onPress,()=>M(!x))},G=(K={})=>({...V,Component:s,showHelper:d,topContent:P,bottomContent:R,buttonPickerProps:z,calendarRef:g,calendarProps:T,prevButtonProps:i(n),nextButtonProps:B(b),errorMessageProps:U(v),className:o.base({class:A}),errorMessage:E,...ue(j,{enabled:y}),...K}),J=c.useMemo(()=>({state:C,slots:o,headerRef:h,weekdayStyle:S,isHeaderExpanded:x,setIsHeaderExpanded:M,visibleMonths:$,showMonthAndYearPickers:w,classNames:m,disableAnimation:f}),[C,o,m,S,x,M,$,f,w]);return{Component:s,children:p,domRef:g,context:J,state:C,slots:o,title:I,classNames:m,getBaseCalendarProps:G}}const Pe=be(function(e,r){const{context:s,getBaseCalendarProps:o}=$e({...e,ref:r});return k.jsx(te,{value:s,children:k.jsx(ne,{...o()})})});export{Pe as R};
