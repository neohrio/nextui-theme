import{r as b}from"./index-Dy2Ak0OH.js";import{a as Pe,$ as $e}from"./useOverlayTriggerState-BqHBeDRf.js";import{a as ge}from"./useFocusRing-BgM-8Y4a.js";import{$ as ve,a as Ee,t as ye,p as Q,b as X,c as Ce}from"./utils-BPavffEa.js";import{d as Te,$ as S}from"./mergeProps-VNdaC4-V.js";import{c as xe,d as Ae}from"./useDialog-zbzkMgjp.js";import{$ as ke}from"./mergeRefs-BpO9bzld.js";import{u as Ne}from"./index-BZiajwfa.js";import{u as Re}from"./provider-context-DmA892L5.js";import{m as Se}from"./utils-Dl_53iLP.js";import{u as we}from"./dom-DrLNPp_C.js";import{o as De}from"./functions-CkCEVJeD.js";import{c as M}from"./clsx-IIdnr2mY.js";import{d as x}from"./assertion-BI5aukJI.js";function Fe(a,e,n){let{type:t}=a,{isOpen:m}=e;b.useEffect(()=>{n&&n.current&&ve.set(n.current,e.close)});let d;t==="menu"?d=!0:t==="listbox"&&(d="listbox");let u=Te();return{triggerProps:{"aria-haspopup":d,"aria-expanded":m,"aria-controls":m?u:void 0,onPress:e.toggle},overlayProps:{id:u}}}let R=new WeakMap,f=[];function Le(a,e=document.body){let n=new Set(a),t=new Set,m=o=>{for(let i of o.querySelectorAll("[data-live-announcer], [data-react-aria-top-layer]"))n.add(i);let s=i=>{if(n.has(i)||i.parentElement&&t.has(i.parentElement)&&i.parentElement.getAttribute("role")!=="row")return NodeFilter.FILTER_REJECT;for(let v of n)if(i.contains(v))return NodeFilter.FILTER_SKIP;return NodeFilter.FILTER_ACCEPT},r=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,{acceptNode:s}),P=s(o);if(P===NodeFilter.FILTER_ACCEPT&&d(o),P!==NodeFilter.FILTER_REJECT){let i=r.nextNode();for(;i!=null;)d(i),i=r.nextNode()}},d=o=>{let s=R.get(o)??0;o.getAttribute("aria-hidden")==="true"&&s===0||(s===0&&o.setAttribute("aria-hidden","true"),t.add(o),R.set(o,s+1))};f.length&&f[f.length-1].disconnect(),m(e);let u=new MutationObserver(o=>{for(let s of o)if(!(s.type!=="childList"||s.addedNodes.length===0)&&![...n,...t].some(r=>r.contains(s.target))){for(let r of s.removedNodes)r instanceof Element&&(n.delete(r),t.delete(r));for(let r of s.addedNodes)(r instanceof HTMLElement||r instanceof SVGElement)&&(r.dataset.liveAnnouncer==="true"||r.dataset.reactAriaTopLayer==="true")?n.add(r):r instanceof Element&&m(r)}});u.observe(e,{childList:!0,subtree:!0});let g={observe(){u.observe(e,{childList:!0,subtree:!0})},disconnect(){u.disconnect()}};return f.push(g),()=>{u.disconnect();for(let o of t){let s=R.get(o);s!=null&&(s===1?(o.removeAttribute("aria-hidden"),R.delete(o)):R.set(o,s-1))}g===f[f.length-1]?(f.pop(),f.length&&f[f.length-1].observe()):f.splice(f.indexOf(g),1)}}const Me=(a,e,n)=>{const t=e==null?void 0:e.current;if(!t||!t.contains(a)){const m=document.querySelectorAll("body > span[data-focus-scope-start]");let d=[];if(m.forEach(u=>{d.push(u.nextElementSibling)}),d.length===1)return n.close(),!1}return!t||!t.contains(a)};function Ie(a,e){const{triggerRef:n,popoverRef:t,showArrow:m,offset:d=7,crossOffset:u=0,scrollRef:g,shouldFlip:o,boundaryElement:s,isDismissable:r=!0,shouldCloseOnBlur:P=!0,shouldCloseOnScroll:i=!0,placement:v="top",containerPadding:I,shouldCloseOnInteractOutside:w,isNonModal:D,isKeyboardDismissDisabled:_,updatePositionDeps:F=[],...B}=a,A=D??!0,{overlayProps:H,underlayProps:h}=Pe({isOpen:e.isOpen,onClose:e.close,shouldCloseOnBlur:P,isDismissable:r,isKeyboardDismissDisabled:_,shouldCloseOnInteractOutside:w||(V=>Me(V,n,e))},t),{overlayProps:K,arrowProps:E,placement:W,updatePosition:q}=Ee({...B,shouldFlip:o,crossOffset:u,targetRef:n,overlayRef:t,isOpen:e.isOpen,scrollRef:g,boundaryElement:s,containerPadding:I,placement:ye(v),offset:m?d+3:d,onClose:A&&i?e.close:()=>{}});return Ne(()=>{F.length&&q()},F),b.useEffect(()=>{if(e.isOpen&&!A&&t.current)return Le([t.current])},[A,e.isOpen,t]),{popoverProps:S(H,K),arrowProps:E,underlayProps:h,placement:W}}function Ye(a){const e=Re(),[n,t]=Se(a,Q.variantKeys),{as:m,ref:d,children:u,state:g,triggerRef:o,scrollRef:s,defaultOpen:r,onOpenChange:P,isOpen:i,isNonModal:v=!0,shouldFlip:I=!0,containerPadding:w=12,shouldBlockScroll:D=!1,isDismissable:_=!0,shouldCloseOnBlur:F,portalContainer:B,updatePositionDeps:A,dialogProps:H,placement:h="top",triggerType:K="dialog",showArrow:E=!1,offset:W=7,crossOffset:q=0,boundaryElement:V,isKeyboardDismissDisabled:Y,shouldCloseOnInteractOutside:Z,shouldCloseOnScroll:ee,motionProps:te,className:oe,classNames:c,onClose:J,...j}=n,se=m||"div",O=we(d),re=b.useRef(null),L=b.useRef(!1),k=o||re,ae=a.disableAnimation??(e==null?void 0:e.disableAnimation)??!1,ne=$e({isOpen:i,defaultOpen:r,onOpenChange:l=>{P==null||P(l),l||J==null||J()}}),p=g||ne,{popoverProps:G,underlayProps:U,placement:y}=Ie({triggerRef:k,isNonModal:v,popoverRef:O,placement:h,offset:W,scrollRef:s,isDismissable:_,shouldCloseOnBlur:F,boundaryElement:V,crossOffset:q,shouldFlip:I,containerPadding:w,updatePositionDeps:A,isKeyboardDismissDisabled:Y,shouldCloseOnScroll:ee,shouldCloseOnInteractOutside:Z},p),{triggerProps:$}=Fe({type:K},p,k),{isFocusVisible:le,isFocused:ie,focusProps:ce}=ge(),C=b.useMemo(()=>Q({...t}),[De(t)]),de=M(c==null?void 0:c.base,oe);xe({isDisabled:!(D&&p.isOpen)});const pe=(l={})=>({ref:O,...S(G,j,l),style:S(G.style,j.style,l.style)}),ue=(l={})=>({"data-slot":"base","data-open":x(p.isOpen),"data-focus":x(ie),"data-arrow":x(E),"data-focus-visible":x(le),"data-placement":X(y||"top",h),...S(ce,H,l),className:C.base({class:M(de)}),style:{outline:"none"}}),fe=b.useCallback((l={})=>({"data-slot":"content","data-open":x(p.isOpen),"data-arrow":x(E),"data-placement":X(y||"top",h),className:C.content({class:M(c==null?void 0:c.content,l.className)})}),[C,p.isOpen,E,y,h,c]),me=b.useMemo(()=>Ce(y||"top",h)&&y||h,[y,h]),z=b.useCallback(l=>{var N;let T;return l.pointerType==="touch"&&((a==null?void 0:a.backdrop)==="blur"||(a==null?void 0:a.backdrop)==="opaque")?T=setTimeout(()=>{L.current=!0},100):L.current=!0,(N=$.onPress)==null||N.call($,l),()=>{clearTimeout(T)}},[$==null?void 0:$.onPress]),be=b.useCallback((l={},T=null)=>{const{isDisabled:N,...Oe}=l;return{"data-slot":"trigger",...S({"aria-haspopup":"dialog"},$,Oe),onPress:z,isDisabled:N,className:C.trigger({class:M(c==null?void 0:c.trigger,l.className),isTriggerDisabled:N}),ref:ke(T,k)}},[p,$,z,k]),he=b.useCallback((l={})=>({"data-slot":"backdrop",className:C.backdrop({class:c==null?void 0:c.backdrop}),onClick:T=>{if(!L.current){T.preventDefault();return}p.close(),L.current=!1},...U,...l}),[C,p.isOpen,c,U]);return b.useEffect(()=>{if(p.isOpen&&(O!=null&&O.current))return Ae([O==null?void 0:O.current])},[p.isOpen,O]),{state:p,Component:se,children:u,classNames:c,showArrow:E,triggerRef:k,placement:me,isNonModal:v,popoverRef:O,portalContainer:B,isOpen:p.isOpen,onClose:p.close,disableAnimation:ae,shouldBlockScroll:D,backdrop:a.backdrop??"transparent",motionProps:te,getBackdropProps:he,getPopoverProps:pe,getTriggerProps:be,getDialogProps:ue,getContentProps:fe}}export{Fe as $,Me as a,Ye as u};
